/home/khoi/Code/GRAPH_RAG_MOVIES/src/llm_service.py:1: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
INFO:     Started server process [86128]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8001 (Press CTRL+C to quit)
  âœ“ Fallback model enabled (Gemini 2.0 Flash - General Knowledge)
  âœ“ Graph Organizer enabled

ğŸš€ Starting Movie GraphRAG API server (v2.0.0)...
ğŸ“ API Documentation: http://localhost:8001/docs
ğŸŒ Frontend: http://localhost:8001
ğŸ’¾ Features: Streaming, Favorites, Ratings, History, Export

INFO:     127.0.0.1:53168 - "GET /api/health HTTP/1.1" 200 OK

ğŸ” Understanding: 'TÃ´i muá»‘n biáº¿t vá» phim Inception'...

ğŸ”§ Query Processor: 'TÃ´i muá»‘n biáº¿t vá» phim Inception'...
  âœ“ Found 2 entities: ['Inception', 'phim']
  âœ“ Found 0 relations: []
  âœ“ Expanded with 8 related terms
  âœ… Processed in 1.3ms (confidence: 0.66)

  âœ“ Query processed (confidence: 0.66)
  â†’ Enhanced: 'TÃ´i muá»‘n biáº¿t vá» phim Inception Inception narrative film tÃ¡c pháº©m story cá»‘t truy...'
ğŸ“Š Using Basic Vector Retrieval...
  âœ“ Found 8/8 relevant matches (threshold: 0.5)
âœ… Found 8 relevant movies in database
ğŸ•¸ï¸  Enriching with detailed information...

  ğŸ”§ Organizing 10 contexts...
  ğŸ“Š Step 1: Pruning
    â†’ Diversity pruning (threshold: 0.65)
    â†’ Kept 8/10 diverse contexts
  ğŸ”„ Step 2: Reranking
    â†’ Reranking 8 contexts by relevance
    â†’ Reranking by source type
    â†’ Position strategy: important_first
  â• Step 3: Augmentation
    â†’ Augmented with summary
    â†’ Augmented with query node
    â†’ Augmented with metadata
  âœ“ Organization complete: 11 refined contexts
ğŸ¤– Generating thoughtful response...
INFO:     127.0.0.1:52442 - "POST /api/chat HTTP/1.1" 200 OK
INFO:     127.0.0.1:50796 - "GET /?id=d7705a59-09d0-4f51-bbae-ac93d60c10bf&vscodeBrowserReqId=1767694783657 HTTP/1.1" 200 OK
INFO:     127.0.0.1:40030 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:40030 - "GET /crawled_data/movies_index.json HTTP/1.1" 200 OK
INFO:     127.0.0.1:40030 - "GET /favicon.ico HTTP/1.1" 404 Not Found

ğŸ” Understanding: 'inception'...

ğŸ”§ Query Processor: 'inception'...
  âœ“ Found 1 entities: ['Inception']
  âœ“ Found 0 relations: []
  âœ“ Expanded with 4 related terms
  âœï¸ Query rewritten for better matching
  âœ… Processed in 1287.1ms (confidence: 0.38)

  âœ“ Query processed (confidence: 0.38)
  â†» Rewritten: 'inception'
ğŸ“Š Using Basic Vector Retrieval...
  âœ“ Found 2/8 relevant matches (threshold: 0.5)
âœ… Found 2 relevant movies in database
ğŸ•¸ï¸  Enriching with detailed information...

  ğŸ”§ Organizing 2 contexts...
  ğŸ“Š Step 1: Pruning
    â†’ Diversity pruning (threshold: 0.65)
    â†’ Kept 2/2 diverse contexts
  ğŸ”„ Step 2: Reranking
    â†’ Reranking 2 contexts by relevance
    â†’ Reranking by source type
  â• Step 3: Augmentation
    â†’ Augmented with query node
    â†’ Augmented with metadata
  âœ“ Organization complete: 4 refined contexts
ğŸ¤– Generating thoughtful response...
INFO:     127.0.0.1:53724 - "POST /api/chat HTTP/1.1" 200 OK
INFO:     127.0.0.1:53724 - "GET /api/poster?url=https%3A%2F%2Fimage.tmdb.org%2Ft%2Fp%2Fw500%2FqJ2tW6WMUDux911r6m7haRef0WH.jpg HTTP/1.1" 200 OK
INFO:     127.0.0.1:53002 - "GET /api/poster?url=https%3A%2F%2Fimage.tmdb.org%2Ft%2Fp%2Fw500%2FxlaY2zyzMfkhk0HSC5VUwzoZPU1.jpg HTTP/1.1" 200 OK
INFO:     127.0.0.1:53000 - "GET /api/poster?url=https%3A%2F%2Fimage.tmdb.org%2Ft%2Fp%2Fw500%2FgEU2QniE6E77NI6lCU6MxlNBvIx.jpg HTTP/1.1" 200 OK

ğŸ” Understanding: 'taylor swift máº¥y grammy'...

ğŸ”§ Query Processor: 'taylor swift máº¥y grammy'...
  âš ï¸  Response blocked (safety): Invalid operation: The `response.text` quick accessor requires the response to c
  âœ“ Found 0 entities: []
  âœ“ Found 0 relations: []
  âœ“ Expanded with 0 related terms
  âœï¸ Query rewritten for better matching
  âœ… Processed in 2856.6ms (confidence: 0.30)

  âœ“ Query processed (confidence: 0.30)
  â†» Rewritten: 'Movie taylor swift máº¥y grammy'
ğŸ“Š Using Basic Vector Retrieval...
  âœ“ Found 8/8 relevant matches (threshold: 0.5)
âœ… Found 8 relevant movies in database
ğŸ•¸ï¸  Enriching with detailed information...

  ğŸ”§ Organizing 9 contexts...
  ğŸ“Š Step 1: Pruning
    â†’ Diversity pruning (threshold: 0.65)
    â†’ Kept 8/9 diverse contexts
  ğŸ”„ Step 2: Reranking
    â†’ Reranking 8 contexts by relevance
    â†’ Reranking by source type
    â†’ Position strategy: important_first
  â• Step 3: Augmentation
    â†’ Augmented with summary
    â†’ Augmented with query node
    â†’ Augmented with metadata
  âœ“ Organization complete: 11 refined contexts
ğŸ¤– Generating thoughtful response...
  âš ï¸ Low confidence detected in RAG answer, trying fallback...
ğŸ”„ Switching to fallback model (Low confidence in RAG answer)...
âœ… Fallback model provided answer
INFO:     127.0.0.1:49622 - "POST /api/chat HTTP/1.1" 200 OK

ğŸ” Understanding: 'hÃ  ná»™i cÃ³ máº¥y phá»‘ phÆ°á»ng'...

ğŸ”§ Query Processor: 'hÃ  ná»™i cÃ³ máº¥y phá»‘ phÆ°á»ng'...
  âš ï¸  Response blocked (safety): Invalid operation: The `response.text` quick accessor requires the response to c
  âœ“ Found 0 entities: []
  âœ“ Found 0 relations: []
  âœ“ Expanded with 0 related terms
  âœï¸ Query rewritten for better matching
  âœ… Processed in 1833.3ms (confidence: 0.30)

  âœ“ Query processed (confidence: 0.30)
  â†» Rewritten: 'Movie hÃ  ná»™i cÃ³ máº¥y phá»‘ phÆ°á»ng'
ğŸ“Š Using Basic Vector Retrieval...
  âœ“ Found 8/8 relevant matches (threshold: 0.5)
âœ… Found 8 relevant movies in database
ğŸ•¸ï¸  Enriching with detailed information...

  ğŸ”§ Organizing 9 contexts...
  ğŸ“Š Step 1: Pruning
    â†’ Diversity pruning (threshold: 0.65)
    â†’ Kept 8/9 diverse contexts
  ğŸ”„ Step 2: Reranking
    â†’ Reranking 8 contexts by relevance
    â†’ Reranking by source type
    â†’ Position strategy: important_first
  â• Step 3: Augmentation
    â†’ Augmented with summary
    â†’ Augmented with query node
    â†’ Augmented with metadata
  âœ“ Organization complete: 11 refined contexts
ğŸ¤– Generating thoughtful response...
  âš ï¸ Low confidence detected in RAG answer, trying fallback...
ğŸ”„ Switching to fallback model (Low confidence in RAG answer)...
âœ… Fallback model provided answer
INFO:     127.0.0.1:48458 - "POST /api/chat HTTP/1.1" 200 OK

ğŸ” Understanding: 'cÃ³ phim avatar 4 khÃ´ng'...

ğŸ”§ Query Processor: 'cÃ³ phim avatar 4 khÃ´ng'...
  âœ“ Found 2 entities: ['phim', 'avatar 4']
  âœ“ Found 0 relations: []
  âœ“ Expanded with 8 related terms
  âœ… Processed in 1564.0ms (confidence: 0.67)

  âœ“ Query processed (confidence: 0.67)
  â†’ Enhanced: 'cÃ³ phim avatar 4 khÃ´ng avatar 4 narrative film tÃ¡c pháº©m story cá»‘t truyá»‡n...'
ğŸ“Š Using Basic Vector Retrieval...
  âœ“ Found 8/8 relevant matches (threshold: 0.5)
âœ… Found 8 relevant movies in database
ğŸ•¸ï¸  Enriching with detailed information...

  ğŸ”§ Organizing 8 contexts...
  ğŸ“Š Step 1: Pruning
    â†’ Diversity pruning (threshold: 0.65)
    â†’ Kept 8/8 diverse contexts
  ğŸ”„ Step 2: Reranking
    â†’ Reranking 8 contexts by relevance
    â†’ Reranking by source type
    â†’ Position strategy: important_first
  â• Step 3: Augmentation
    â†’ Augmented with summary
    â†’ Augmented with query node
    â†’ Augmented with metadata
  âœ“ Organization complete: 11 refined contexts
ğŸ¤– Generating thoughtful response...
INFO:     127.0.0.1:53280 - "POST /api/chat HTTP/1.1" 200 OK
INFO:     127.0.0.1:53280 - "GET /api/poster?url=https%3A%2F%2Fimage.tmdb.org%2Ft%2Fp%2Fw500%2Ft6HIqrRAclMCA60NsSmeqe9RmNV.jpg HTTP/1.1" 200 OK
INFO:     127.0.0.1:37586 - "GET /api/poster?url=https%3A%2F%2Fimage.tmdb.org%2Ft%2Fp%2Fw500%2Fg96wHxU7EnoIFwemb2RgohIXrgW.jpg HTTP/1.1" 200 OK
INFO:     127.0.0.1:37582 - "GET /api/poster?url=https%3A%2F%2Fimage.tmdb.org%2Ft%2Fp%2Fw500%2FgKY6q7SjCkAU6FqvqWybDYgUKIF.jpg HTTP/1.1" 200 OK

ğŸ” Understanding: 'hat animated films from Pixar have won Academy Awards and feature voice actors who also appeared in live-action comedies?'...

ğŸ”§ Query Processor: 'hat animated films from Pixar have won Academy Awards and feature voice actors who also appeared in live-action comedies?'...
  âœ“ Found 3 entities: ['Pixar have won Academy Awards and feature voice actors who also appeared in live', 'film', 'actor']
  âœ“ Found 2 relations: ['ACTED_IN', 'BELONGS_TO']
  âœ“ Decomposed into 3 sub-queries
  ğŸ”€ Complex query split into 3 sub-queries
  âœ“ Expanded with 9 related terms
  âœ… Processed in 7247.0ms (confidence: 0.88)

  âœ“ Query processed (confidence: 0.88)
  â†’ Enhanced: 'hat animated films from Pixar have won Academy Awards and feature voice actors w...'
ğŸ“Š Using Basic Vector Retrieval...
  âœ“ Found 8/8 relevant matches (threshold: 0.5)
âœ… Found 8 relevant movies in database
ğŸ•¸ï¸  Enriching with detailed information...
  â†’ Using relation-aware search: ['ACTED_IN', 'BELONGS_TO']

  ğŸ”§ Organizing 9 contexts...
  ğŸ“Š Step 1: Pruning
    â†’ Diversity pruning (threshold: 0.65)
    â†’ Kept 8/9 diverse contexts
  ğŸ”„ Step 2: Reranking
    â†’ Reranking 8 contexts by relevance
    â†’ Reranking by source type
    â†’ Position strategy: important_first
  â• Step 3: Augmentation
    â†’ Augmented with summary
    â†’ Augmented with query node
    â†’ Augmented with metadata
  âœ“ Organization complete: 11 refined contexts
ğŸ¤– Generating thoughtful response...
  âš ï¸ Low confidence detected in RAG answer, trying fallback...
ğŸ”„ Switching to fallback model (Low confidence in RAG answer)...
âœ… Fallback model provided answer
INFO:     127.0.0.1:37586 - "POST /api/chat HTTP/1.1" 200 OK
INFO:     127.0.0.1:52876 - "GET /api/poster?url=https%3A%2F%2Fimage.tmdb.org%2Ft%2Fp%2Fw500%2F6jmppcaubzLF8wkXM36ganVISCo.jpg HTTP/1.1" 200 OK
INFO:     127.0.0.1:52892 - "GET /api/poster?url=https%3A%2F%2Fimage.tmdb.org%2Ft%2Fp%2Fw500%2FuXDfjJbdP4ijW5hWSBrPrlKpxab.jpg HTTP/1.1" 200 OK
INFO:     127.0.0.1:37586 - "GET /api/poster?url=https%3A%2F%2Fimage.tmdb.org%2Ft%2Fp%2Fw500%2F6Ryitt95xrO8KXuqRGm1fUuNwqF.jpg HTTP/1.1" 200 OK
INFO:     127.0.0.1:46646 - "GET /?id=d7705a59-09d0-4f51-bbae-ac93d60c10bf&vscodeBrowserReqId=1767695281166 HTTP/1.1" 200 OK
INFO:     127.0.0.1:43958 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:43958 - "GET /crawled_data/movies_index.json HTTP/1.1" 200 OK
INFO:     127.0.0.1:43958 - "GET /favicon.ico HTTP/1.1" 404 Not Found

ğŸ” Understanding: 'xin chÃ o'...

ğŸ”§ Query Processor: 'xin chÃ o'...
  âš ï¸  Response blocked (safety): Invalid operation: The `response.text` quick accessor requires the response to c
  âœ“ Found 0 entities: []
  âœ“ Found 0 relations: []
  âœ“ Expanded with 0 related terms
  âœï¸ Query rewritten for better matching
  âœ… Processed in 1436.7ms (confidence: 0.30)

  âœ“ Query processed (confidence: 0.30)
  â†» Rewritten: 'Movie xin chÃ o'
ğŸ“Š Using Basic Vector Retrieval...
  âœ“ Found 8/8 relevant matches (threshold: 0.5)
âœ… Found 8 relevant movies in database
ğŸ•¸ï¸  Enriching with detailed information...

  ğŸ”§ Organizing 9 contexts...
  ğŸ“Š Step 1: Pruning
    â†’ Diversity pruning (threshold: 0.65)
    â†’ Kept 8/9 diverse contexts
  ğŸ”„ Step 2: Reranking
    â†’ Reranking 8 contexts by relevance
    â†’ Reranking by source type
    â†’ Position strategy: important_first
  â• Step 3: Augmentation
    â†’ Augmented with summary
    â†’ Augmented with query node
    â†’ Augmented with metadata
  âœ“ Organization complete: 11 refined contexts
ğŸ¤– Generating thoughtful response...
  âš ï¸ Low confidence detected in RAG answer, trying fallback...
ğŸ”„ Switching to fallback model (Low confidence in RAG answer)...
âœ… Fallback model provided answer
INFO:     127.0.0.1:43958 - "POST /api/chat HTTP/1.1" 200 OK
INFO:     127.0.0.1:43958 - "GET /api/poster?url=https%3A%2F%2Fimage.tmdb.org%2Ft%2Fp%2Fw500%2F9E2y5Q7WlCVNEhP5GiVTjhEhx1o.jpg HTTP/1.1" 200 OK

ğŸ” Understanding: 'Phim Inception ngon khÃ´ng ?'...

ğŸ”§ Query Processor: 'Phim Inception ngon khÃ´ng ?'...
  âœ“ Found 2 entities: ['Phim Inception ngon', 'phim']
  âœ“ Found 0 relations: []
  âœ“ Expanded with 8 related terms
  âœ… Processed in 0.1ms (confidence: 0.66)

  âœ“ Query processed (confidence: 0.66)
  â†’ Enhanced: 'Phim Inception ngon khÃ´ng ? Phim Inception ngon narrative film tÃ¡c pháº©m story cá»‘...'
ğŸ“Š Using Basic Vector Retrieval...
  âœ“ Found 6/8 relevant matches (threshold: 0.5)
âœ… Found 6 relevant movies in database
ğŸ•¸ï¸  Enriching with detailed information...

  ğŸ”§ Organizing 8 contexts...
  ğŸ“Š Step 1: Pruning
    â†’ Diversity pruning (threshold: 0.65)
    â†’ Kept 6/8 diverse contexts
  ğŸ”„ Step 2: Reranking
    â†’ Reranking 6 contexts by relevance
    â†’ Reranking by source type
    â†’ Position strategy: important_first
  â• Step 3: Augmentation
    â†’ Augmented with summary
    â†’ Augmented with query node
    â†’ Augmented with metadata
  âœ“ Organization complete: 9 refined contexts
ğŸ¤– Generating thoughtful response...
  âš ï¸ Low confidence detected in RAG answer, trying fallback...
ğŸ”„ Switching to fallback model (Low confidence in RAG answer)...
âœ… Fallback model provided answer
INFO:     127.0.0.1:49754 - "POST /api/chat HTTP/1.1" 200 OK
INFO:     127.0.0.1:50454 - "GET /api/poster?url=https%3A%2F%2Fimage.tmdb.org%2Ft%2Fp%2Fw500%2FeCOtqtfvn7mxGl6nfmq4b1exJRc.jpg HTTP/1.1" 200 OK
INFO:     127.0.0.1:49754 - "GET /api/poster?url=https%3A%2F%2Fimage.tmdb.org%2Ft%2Fp%2Fw500%2FxlaY2zyzMfkhk0HSC5VUwzoZPU1.jpg HTTP/1.1" 200 OK
INFO:     127.0.0.1:50450 - "GET /api/poster?url=https%3A%2F%2Fimage.tmdb.org%2Ft%2Fp%2Fw500%2FlBscKQzEJY1XF2ReZT2vIGrMQ1k.jpg HTTP/1.1" 200 OK
